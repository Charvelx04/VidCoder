<Window
	x:Class="VidCoder.View.PreviewWindow"
	xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:controls="clr-namespace:VidCoder.Controls"
	xmlns:prop="clr-namespace:VidCoder.Properties"
	xmlns:res="clr-namespace:VidCoder.LocalResources" 
	Title="{Binding Title}"
	Width="864" Height="514"
	MinWidth="405" MinHeight="200"
	Closing="Window_Closing"
	AllowDrop="True"
	PreviewDrop="Window_PreviewDrop"
	PreviewDragOver="Window_PreviewDragOver"
	ShowInTaskbar="False" WindowStyle="ToolWindow"
	TextOptions.TextFormattingMode="Display">
	<Window.Resources>
		<Style x:Key="PreviewText" TargetType="TextBlock">
			<Setter Property="Foreground" Value="White" />
		</Style>
		<Storyboard x:Key="FadePreviewControlsOut">
			<DoubleAnimation
				Storyboard.TargetProperty="Opacity"
				To="0.0" Duration="0:0:1.5" />
		</Storyboard>
		<Storyboard x:Key="FadePreviewControlsIn">
			<DoubleAnimation
				Storyboard.TargetProperty="Opacity"
				To="1.0" Duration="0:0:0.2" />
		</Storyboard>
	</Window.Resources>
	<Window.InputBindings>
		<KeyBinding Key="Q" Modifiers="Control" Command="{Binding ProcessingVM.AddToQueueCommand}" />
		<KeyBinding Key="L" Modifiers="Control" Command="{Binding WindowManagerVM.OpenLogWindowCommand}" />
		<KeyBinding Key="N" Modifiers="Control" Command="{Binding WindowManagerVM.OpenEncodingWindowCommand}" />
		<KeyBinding Key="O" Modifiers="Control+Shift" Command="{Binding ProcessingVM.QueueFilesCommand}" />
		<KeyBinding Key="T" Modifiers="Control" Command="{Binding ProcessingVM.QueueTitlesCommand}" />
		<KeyBinding Key="D" Modifiers="Control" Command="{Binding OutputPathVM.PickOutputPathCommand}" />
	</Window.InputBindings>
	<Grid>
		<Grid Margin="0" Name="previewImageHolder" SizeChanged="previewImageHolder_SizeChanged" Background="#666666">
			<Image
				Name="previewImage" Stretch="Fill" HorizontalAlignment="Left" VerticalAlignment="Top"
				Source="{Binding PreviewImage}"
				Visibility="{Binding HasPreview, Converter={StaticResource VisibilityConverter}}"/>
			<Grid
				Name="previewControls" Margin="6,0,6,6" Height="71" VerticalAlignment="Bottom">
				<Grid.Style>
					<Style TargetType="Grid">
						<Style.Triggers>
							<MultiDataTrigger>
								<MultiDataTrigger.Conditions>
									<Condition Binding="{Binding Path=IsMouseOver, ElementName=previewImageHolder}" Value="False" />
									<Condition Binding="{Binding GeneratingPreview}" Value="False" />
								</MultiDataTrigger.Conditions>
								<MultiDataTrigger.EnterActions>
									<BeginStoryboard Storyboard="{StaticResource FadePreviewControlsOut}" x:Name="FadePreviewControlsOut_BeginStoryboard" />
								</MultiDataTrigger.EnterActions>
								<MultiDataTrigger.ExitActions>
									<RemoveStoryboard BeginStoryboardName="FadePreviewControlsOut_BeginStoryboard" />
									<BeginStoryboard Storyboard="{StaticResource FadePreviewControlsIn}" x:Name="FadePreviewControlsIn_BeginStoryboard" />
								</MultiDataTrigger.ExitActions>
							</MultiDataTrigger>
						</Style.Triggers>
					</Style>
				</Grid.Style>
				<Border CornerRadius="10" Background="#111" Opacity="0.9" />
				<controls:SeekBar
					Height="24" Margin="10,8,10,0" VerticalAlignment="Top"
					Slot="{Binding SelectedPreview, Mode=TwoWay}"
					NumSlots="{Binding PreviewCount, Mode=OneWay}"
					IsEnabled="{Binding SeekBarEnabled}"
					/>
				<StackPanel
					Orientation="Horizontal" Margin="0,0,0,8" VerticalAlignment="Bottom" HorizontalAlignment="Center"
					Visibility="{Binding GeneratingPreview, Converter={StaticResource VisibilityConverter}, ConverterParameter=True}">
					<Button
						Height="23"
						Command="{Binding PlaySourceCommand}" ToolTip="{Binding PlaySourceToolTip}" ToolTipService.ShowOnDisabled="True"
						Margin="0,0,0,0">
						<StackPanel Orientation="Horizontal" Margin="4,0">
							<Image Source="/Icons/blue_play_80.png" VerticalAlignment="Center" Height="15" />
							<TextBlock Text="{x:Static res:PreviewRes.PlaySourceButton}" Margin="5,0,0,0" VerticalAlignment="Center" />
						</StackPanel>
					</Button>
					<Button
						Height="23"
						Command="{Binding GeneratePreviewCommand}" ToolTip="{x:Static res:PreviewRes.EncodePreviewClipToolTip}"
						Margin="20,0,0,0">
						<StackPanel Orientation="Horizontal" Margin="4,0">
							<Image Source="/Icons/play_clip.png" VerticalAlignment="Center" Height="15" />
							<TextBlock Text="{x:Static res:PreviewRes.EncodePreviewClipButton}" Margin="5,0,0,0" VerticalAlignment="Center" />
						</StackPanel>
					</Button>
					<ComboBox
						Height="22" Width="45" Margin="10,0,0,0"
						SelectedValue="{Binding PreviewSeconds}"
						SelectedValuePath="Content">
						<ComboBoxItem>5</ComboBoxItem>
						<ComboBoxItem>10</ComboBoxItem>
						<ComboBoxItem>15</ComboBoxItem>
						<ComboBoxItem>30</ComboBoxItem>
						<ComboBoxItem>60</ComboBoxItem>
						<ComboBoxItem>120</ComboBoxItem>
					</ComboBox>
					<TextBlock
						Text="{x:Static res:PreviewRes.Seconds}" VerticalAlignment="Center" Margin="7,0,0,0"
						Style="{StaticResource PreviewText}" />
				</StackPanel>
				<Grid 
					VerticalAlignment="Bottom" Margin="12,0,12,8">
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="Auto" />
						<ColumnDefinition />
						<ColumnDefinition Width="Auto" />
					</Grid.ColumnDefinitions>
					<TextBlock
						Grid.Column="0"
						HorizontalAlignment="Left" VerticalAlignment="Center"
						Style="{StaticResource PreviewText}"
						Text="{x:Static res:PreviewRes.GeneratingPreview}"
						Visibility="{Binding GeneratingPreview, Converter={StaticResource VisibilityConverter}}" />
					<ProgressBar
						Grid.Column="1"
						HorizontalAlignment="Stretch" VerticalAlignment="Bottom" Height="20" Margin="10,0,10,0"
						Visibility="{Binding GeneratingPreview, Converter={StaticResource VisibilityConverter}}"
						Value="{Binding PreviewPercentComplete}"/>
					<Button
						Grid.Column="2"
						Content="{x:Static prop:Resources.Cancel}"
						HorizontalAlignment="Right" VerticalAlignment="Bottom" Height="23" MinWidth="55"
						Visibility="{Binding GeneratingPreview, Converter={StaticResource VisibilityConverter}}"
						Command="{Binding CancelPreviewCommand}"/>
				</Grid>

			</Grid>
		</Grid>
	</Grid>
</Window>
