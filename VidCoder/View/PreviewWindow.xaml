<Window x:Class="VidCoder.View.PreviewWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="{Binding Title}" Height="514" Width="864" Closing="Window_Closing" ShowInTaskbar="False" WindowStyle="ToolWindow">
    <Window.Resources>
        <Storyboard x:Key="FadePreviewControlsOut">
            <DoubleAnimation
                Storyboard.TargetProperty="Opacity"
                To="0.0" Duration="0:0:1.5" />
        </Storyboard>
        <Storyboard x:Key="FadePreviewControlsIn">
            <DoubleAnimation
                Storyboard.TargetProperty="Opacity"
                To="1.0" Duration="0:0:0.2" />
        </Storyboard>
    </Window.Resources>
    <Grid>
        <Grid Margin="0" Name="previewImageHolder" SizeChanged="previewImageHolder_SizeChanged" Background="#222222">
            <Image
                Name="previewImage" Stretch="Fill" HorizontalAlignment="Left" VerticalAlignment="Top"
                Source="{Binding PreviewSource}"
                Visibility="{Binding HasPreview, Converter={StaticResource VisibilityConverter}}"/>
            <Grid
                Name="previewControls" Margin="6,0,6,6" Height="66" VerticalAlignment="Bottom">
                <Grid.Style>
                    <Style TargetType="Grid">
                        <Style.Triggers>
                            <MultiDataTrigger>
                                <MultiDataTrigger.Conditions>
                                    <Condition Binding="{Binding Path=IsMouseOver, ElementName=previewImageHolder}" Value="False" />
                                    <Condition Binding="{Binding GeneratingPreview}" Value="False" />
                                </MultiDataTrigger.Conditions>
                                <MultiDataTrigger.EnterActions>
                                    <BeginStoryboard Storyboard="{StaticResource FadePreviewControlsOut}" x:Name="FadePreviewControlsOut_BeginStoryboard" />
                                </MultiDataTrigger.EnterActions>
                                <MultiDataTrigger.ExitActions>
                                    <RemoveStoryboard BeginStoryboardName="FadePreviewControlsOut_BeginStoryboard" />
                                    <BeginStoryboard Storyboard="{StaticResource FadePreviewControlsIn}" x:Name="FadePreviewControlsIn_BeginStoryboard" />
                                </MultiDataTrigger.ExitActions>
                            </MultiDataTrigger>
                            <!--<DataTrigger Binding="{Binding Path=IsMouseOver, ElementName=previewImageHolder}" Value="True">
                                <Setter Property="Opacity" Value="1.0" />
                            </DataTrigger>
                            <DataTrigger Binding="{Binding GeneratingPreview}" Value="True">
                                <Setter Property="Opacity" Value="1.0" />
                            </DataTrigger>-->
                            <!--<DataTrigger Binding="{Binding Path=IsMouseOver, ElementName=previewImageHolder}" Value="False">
                                <DataTrigger.EnterActions>
                                    <BeginStoryboard Storyboard="{StaticResource FadePreviewControlsOut}" x:Name="FadePreviewControlsOut_BeginStoryboard" />
                                </DataTrigger.EnterActions>
                                <DataTrigger.ExitActions>
                                    <RemoveStoryboard BeginStoryboardName="FadePreviewControlsOut_BeginStoryboard" />
                                </DataTrigger.ExitActions>
                                <Setter Property="Visibility" Value="Collapsed" />
                            </DataTrigger>-->
                            <!--<DataTrigger Binding="{Binding GeneratingPreview}" Value="True">
                                <Setter Property="Visibility" Value="Visible" />
                            </DataTrigger>-->
                        </Style.Triggers>
                    </Style>
                </Grid.Style>
                <Border CornerRadius="10" Background="WhiteSmoke" Opacity="0.9" />
                <Slider
                    Height="22" Margin="10,8,10,0" VerticalAlignment="Top"
                    TickPlacement="BottomRight"
                    Minimum="0"
                    Maximum="{Binding SliderMax}"
                    TickFrequency="1"
                    IsSnapToTickEnabled="True"
                    IsEnabled="{Binding SliderEnabled}"
                    FocusVisualStyle="{x:Null}"
                    Value="{Binding SelectedPreview}" />
                <StackPanel
                    Orientation="Horizontal" Margin="0,0,0,8" VerticalAlignment="Bottom" HorizontalAlignment="Center"
                    Visibility="{Binding GeneratingPreview, Converter={StaticResource VisibilityConverter}, ConverterParameter=True}">
                    <Button
                        Height="23" Width="60"
                        Command="{Binding GeneratePreviewCommand}">Play</Button>
                    <ComboBox
                        Height="22" Width="40" Margin="20,0,0,0"
                        SelectedValue="{Binding PreviewSeconds}"
                        SelectedValuePath="Content">
                        <ComboBoxItem>5</ComboBoxItem>
                        <ComboBoxItem>10</ComboBoxItem>
                        <ComboBoxItem>15</ComboBoxItem>
                        <ComboBoxItem>30</ComboBoxItem>
                        <ComboBoxItem>60</ComboBoxItem>
                    </ComboBox>
                    <TextBlock Text="seconds" VerticalAlignment="Center" Margin="7,0,0,0" />
                </StackPanel>
                <TextBlock
                    HorizontalAlignment="Left" VerticalAlignment="Bottom" Margin="12,0,0,12"
                    Text="Generating preview..."
                    Visibility="{Binding GeneratingPreview, Converter={StaticResource VisibilityConverter}}" />
                <ProgressBar
                    HorizontalAlignment="Stretch" VerticalAlignment="Bottom" Margin="135,0,12,9" Height="20"
                    Visibility="{Binding GeneratingPreview, Converter={StaticResource VisibilityConverter}}"
                    Value="{Binding PreviewPercentComplete}"/>
            </Grid>
        </Grid>
    </Grid>
</Window>
